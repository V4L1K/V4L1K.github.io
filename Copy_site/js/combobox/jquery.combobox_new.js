(function(){jQuery.fn.combobox=function(selectOptions){return this.each(function(){var newCombobox=new Combobox(this,selectOptions);jQuery.combobox.instances.push(newCombobox);});};jQuery.combobox={instances:[]};var Combobox=function(textInputElement,selectOptions){this.textInputElement=jQuery(textInputElement);this.selector=new ComboboxSelector(this);this.setSelectOptions(selectOptions);var inputHeight=this.textInputElement.outerHeight();var buttonLeftPosition=this.textInputElement.outerWidth()+0;var showSelectorButton=jQuery('<a href="#" class="combobox_button" '+'style="position:absolute; height:1px; width: 1px;'+'top:0; left:'+buttonLeftPosition+'px;"><div class="combobox_arrow"></div></a>').insertAfter(this.textInputElement);var thisSelector=this.selector;var thisCombobox=this;showSelectorButton.click(function(e){jQuery('html').trigger('click');thisSelector.buildSelectOptionList();thisSelector.show();thisCombobox.focus();return false;})
this.bindKeypress();};Combobox.prototype={setSelectOptions:function(selectOptions){this.selector.setSelectOptions(selectOptions);this.selector.buildSelectOptionList(this.getValue());},bindKeypress:function(){var thisCombobox=this;this.textInputElement.keyup(function(event){if(event.keyCode==Combobox.keys.TAB||event.keyCode==Combobox.keys.SHIFT){return;}if(event.keyCode!=Combobox.keys.DOWNARROW&&event.keyCode!=Combobox.keys.UPARROW&&event.keyCode!=Combobox.keys.ESCAPE&&event.keyCode!=Combobox.keys.ENTER){thisCombobox.selector.buildSelectOptionList(thisCombobox.getValue());}thisCombobox.selector.show()});},setValue:function(value){},getValue:function(){return this.textInputElement.val();},focus:function(){this.textInputElement.trigger('focus');}};Combobox.keys={UPARROW:38,DOWNARROW:40,ENTER:13,ESCAPE:27,TAB:9,SHIFT:16};var ComboboxSelector=function(combobox){this.combobox=combobox;this.url="";this.enter=false;this.optionCount=0;this.selectedIndex=-1;this.allSelectOptions=[];var selectorTop=combobox.textInputElement.outerHeight();var selectorWidth=combobox.textInputElement.outerWidth();this.selectorElement=jQuery('<div class="combobox_selector" '+'></div>').insertAfter($("label[for=searchbtn]"));var thisSelector=this;this.keypressHandler=function(e){thisSelector.enter=false;if(e.keyCode==Combobox.keys.DOWNARROW){thisSelector.selectNext();}else if(e.keyCode==Combobox.keys.UPARROW){thisSelector.selectPrevious();}else if(e.keyCode==Combobox.keys.ESCAPE){thisSelector.hide();thisSelector.combobox.focus();}else if(e.keyCode==Combobox.keys.ENTER){thisSelector.enter=true;if(thisSelector.url!="")location.href=thisSelector.url;return false;}return false;}}
ComboboxSelector.prototype={setSelectOptions:function(selectOptions){this.allSelectOptions=selectOptions;},buildSelectOptionList:function(startingLetters){if(!startingLetters){startingLetters="";}this.unselect();this.selectorElement.empty();var selectOptions=[];this.selectedIndex=-1;for(var i=0;i<this.allSelectOptions.length;i++){if(!startingLetters.length||this.allSelectOptions[i].toLowerCase().indexOf(startingLetters.toLowerCase())===0){selectOptions.push(this.allSelectOptions[i]);}}this.optionCount=selectOptions.length;var ulElement=jQuery('<ul class="combo"></ul>').appendTo(this.selectorElement);for(var i=0;i<selectOptions.length;i++){ulElement.append('<li lid="'+i+'">'+selectOptions[i]+'</li>');}var thisSelector=this;this.selectorElement.find('li').click(function(e){location.href=thisSelector.url;return false;});this.selectorElement.find('li:last').unbind('click');this.selectorElement.find('li').mouseover(function(e){var si=$(this).attr('lid');thisSelector.url=$("#cbb"+si).val();});this.selectorElement.mouseover(function(e){thisSelector.unselect();});this.htmlClickHandler=function(){thisSelector.hide();};this.selectorElement.find('li').keydown(function(e){});},show:function(){if(this.selectorElement.find('li').length<1||this.selectorElement.is(':visible')){return false;}jQuery('html').keyup(this.keypressHandler);this.selectorElement.slideDown('fast');jQuery('html').click(this.htmlClickHandler);return true;},hide:function(){jQuery('html').unbind('keyup',this.keypressHandler);jQuery('html').unbind('click',this.htmlClickHandler);this.selectorElement.unbind('click');this.unselect();this.selectorElement.hide();},selectNext:function(){var newSelectedIndex=this.selectedIndex+1;if(newSelectedIndex>this.optionCount-1){newSelectedIndex=0;}this.select(newSelectedIndex);this.url=$("#cbb"+newSelectedIndex).val();},selectPrevious:function(){var newSelectedIndex=this.selectedIndex-1;if(newSelectedIndex<0){newSelectedIndex=this.optionCount-1;}this.select(newSelectedIndex);this.url=$("#cbb"+newSelectedIndex).val();},select:function(index){this.unselect();this.selectorElement.find('li:eq('+index+')').addClass('selected');this.selectedIndex=index;},unselect:function(){this.selectorElement.find('li').removeClass('selected');this.selectedIndex=-1;},getSelectedValue:function(){return this.selectorElement.find('li').get(this.selectedIndex).innerHTML;},getSelectedIndex:function(){return this.selectedIndex;}};})();